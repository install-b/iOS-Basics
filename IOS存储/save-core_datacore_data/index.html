<!DOCTYPE HTML>
<html lang="en" >
    <!-- Start book 目录--回到所有书目录 -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>core data存储 | 目录--回到所有书目录</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-splitter/splitter.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-tbfed-pagefooter/footer.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../nsdata/index.html" />
    
    
    <link rel="prev" href="../save-sqlite3sqlite3/index.html" />
    

        <!-- head:end -->
    </head>
    <body>
        <!-- body:start -->
        
    <div class="book"
        data-level="6"
        data-chapter-title="core data存储"
        data-filepath="save-core_datacore_data/README.md"
        data-basepath=".."
        data-revision="Mon Jun 06 2016 14:55:00 GMT+0800 (CST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
                
                <li>
                    <a href="http://fzq2016.github.io/index.html" target="blank" class="custom-link">Home</a>
                </li>
            
            

            
            <li class="divider"></li>
            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        目录
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="chapter-10/index.html">
            
                
                    <a href="../chapter-10/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        数据存储介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="save-plistplist/index.html">
            
                
                    <a href="../save-plistplist/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        plist存储
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="save-userdefaults/index.html">
            
                
                    <a href="../save-userdefaults/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        偏好设置存储
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="nskeyedarchiver/index.html">
            
                
                    <a href="../nskeyedarchiver/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        NSKeyedArchiver存储
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="save-sqlite3sqlite3/index.html">
            
                
                    <a href="../save-sqlite3sqlite3/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        SQLite3存储
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="6" data-path="save-core_datacore_data/index.html">
            
                
                    <a href="../save-core_datacore_data/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        core data存储
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="nsdata/index.html">
            
                
                    <a href="../nsdata/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        NSData
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="nsmanagedobject/index.html">
            
                
                    <a href="../nsmanagedobject/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        NSManagedObject
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="nscoder/index.html">
            
                
                    <a href="../nscoder/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        NSCoder
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="fmdb/index.html">
            
                
                    <a href="../fmdb/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        FMDB
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >目录--回到所有书目录</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <!--## save-core data（core data存储）-->
<!--1. Core Data框架提供了对象-关系映射(ORM)的功能，即能够将OC对象转化成数据，保存在SQLite3数据库文件中，也能够将保存在数据库中的数据还原成OC对象。在此数据操作期间，不需要编写任何SQL语句。-->
<!--- 使用此功能，要添加CoreData.framework和导入主头文件<CoreData/CoreData.h>-->
<!--- 在Core Data，需要进行映射的对象称为实体(entity)，而且需要使用Core Data的模型文件来描述应用的所有实体和实体属性-->
<!--这里以Person和Card(身份证)2个实体为例子，先看看实体属性和之间的关联关系-->
<!--![](模型文件.png)-->
<!--![](模型文件2.png)-->
<!--![](模型3.png)-->
<!--| 对象 | 属性1 | 属性2 | 属性3 |-->
<!--| -- | -- | -- | -- |-->
<!--| Person | name | age | card |-->
<!--| Card | number | person | - |-->
<!--    Person中有个Card属性，Card中有个Person属性,属于一对一双向关联-->
<!--### core data 主要对象-->
<!--```objc-->
<!--NSManagedObjectContext-->
<!--用途：负责应用和数据库之间的交互(CRUD)-->
<!--.persistentStoreCoordinator-->
<!--NSPersistentStoreCoordinator-->
<!--用途:添加持久化存储库(比如SQLite数据库)-->
<!--.managedObjectModel-->
<!--NSManagedObjectModel-->
<!--用途：代表Core Data的模型文件-->
<!--.entities-->
<!--NSEntityDescription-->
<!--用途：用来描述实体-->
<!--.name = @”Card”-->
<!--NSEntityDescription-->
<!--用途：用来描述实体-->
<!--.name = @”Person”-->
<!--```-->
<!--### 搭建Core Data上下文环境-->
<!--```objc-->
<!--//从应用程序包中加载模型文件-->
<!--NSManagedObjectModel *model = [NSManagedObjectModel mergedModelFromBundles:nil];-->
<!--传入模型，初始化NSPersistentStoreCoordinator-->
<!--NSPersistentStoreCoordinator *psc = [[[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:model] autorelease];-->
<!--构建SQLite文件路径-->
<!--NSString *docs = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject];-->
<!--NSURL *url = [NSURL fileURLWithPath:[docs stringByAppendingPathComponent:@"person.data"]];-->
<!--### 添加持久化存储库，这里使用SQLite作为存储库-->
<!--NSError *error = nil;-->
<!--NSPersistentStore *store = [psc addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:url options:nil error:&error];-->
<!--if (store == nil) { // 直接抛异常-->
<!--    [NSException raise:@"添加数据库错误" format:@"%@", [error localizedDescription]];-->
<!--}-->
<!--初始化上下文，设置persistentStoreCoordinator属性-->
<!--NSManagedObjectContext *context = [[NSManagedObjectContext alloc] init];-->
<!--context.persistentStoreCoordinator = psc;-->
<!--// 用完之后，还是要[context release];-->
<!--###添加数据-->
<!--传入上下文，创建一个Person实体对象-->
<!--NSManagedObject *person = [NSEntityDescription insertNewObjectForEntityForName:@"Person" inManagedObjectContext:context];-->
<!--设置简单属性-->
<!--[person setValue:@"MJ" forKey:@"name"];-->
<!--[person setValue:[NSNumber numberWithInt:27] forKey:@"age"];-->
<!--传入上下文，创建一个Card实体对象-->
<!--NSManagedObject *card = [NSEntityDescription insertNewObjectForEntityForName:@"Card" inManagedObjectContext:context];-->
<!--[card setValue:@"4414241933432" forKey:@"no"];-->
<!--设置Person和Card之间的关联关系-->
<!--[person setValue:card forKey:@"card"];-->
<!--利用上下文对象，将数据同步到持久化存储库-->
<!--NSError *error = nil;-->
<!--BOOL success = [context save:&error];-->
<!--if (!success) {-->
<!--    [NSException raise:@"访问数据库错误" format:@"%@", [error localizedDescription]];-->
<!--}-->
<!--// 如果是想做更新操作：只要在更改了实体对象的属性后调用[context save:&error]，就能将更改的数据同步到数据库-->
<!--###查询数据-->
<!--初始化一个查询请求-->
<!--NSFetchRequest *request = [[[NSFetchRequest alloc] init] autorelease];-->
<!--设置要查询的实体-->
<!--NSEntityDescription *desc = [NSEntityDescription entityForName:@"Person" inManagedObjectContext:context];-->
<!--设置排序（按照age降序）-->
<!--NSSortDescriptor *sort = [NSSortDescriptor sortDescriptorWithKey:@"age" ascending:NO];-->
<!--request.sortDescriptors = [NSArray arrayWithObject:sort];-->
<!--设置条件过滤(name like '%Itcast-1%')-->
<!--NSPredicate *predicate = [NSPredicate predicateWithFormat:@"name like %@", @"*Itcast-1*"];-->
<!--request.predicate = predicate;-->
<!--###执行请求-->
<!--NSError *error = nil;-->
<!--NSArray *objs = [context executeFetchRequest:request error:&error];-->
<!--if (error) {-->
<!--    [NSException raise:@"查询错误" format:@"%@", [error localizedDescription]];-->
<!--}-->
<!--###遍历数据-->
<!--for (NSManagedObject *obj in objs) {-->
<!--    NSLog(@"name=%@", [obj valueForKey:@"name"]-->
<!--}-->
<!--###删除数据-->
<!--传入需要删除的实体对象-->
<!--[context deleteObject:managedObject];-->
<!--将结果同步到数据库-->
<!--NSError *error = nil;-->
<!--[context save:&error];-->
<!--if (error) {-->
<!--    [NSException raise:@"删除错误" format:@"%@", [error localizedDescription]];-->
<!--}-->
<!--###打开Core Data的SQL日志输出开关，步骤：-->
<!--1.打开Product，点击Edit Scheme...-->
<!--2.点击Arguments，在Arguments Passed On Launch中添加2项-->
<!--- -com.apple.CoreData.SQLDebug-->
<!--- 1-->
<!--###Core Data的延迟加载-->
<!--Core Data不会根据实体中的关联关系立即获取相应的关联对象-->
<!--比如通过Core Data取出Person实体时，并不会立即查询相关联的Card实体；当应用真的需要使用Card时，才会查询数据库，加载Card实体的信息-->
<!--###创建NSManagedObject的子类-->
<!--默认情况下，利用Core Data取出的实体都是NSManagedObject类型的，能够利用键-值对来存取数据-->
<!--但是一般情况下，实体在存取数据的基础上，有时还需要添加一些业务方法来完成一些其他任务，那么就必须创建NSManagedObject的子类-->
<!--```-->
<!--###创建NSManagedObject的子类-->
<!--![](创建NSManagedObject的子类.png)-->
<!--![](创建NSManagedObject的子类2.png)-->
<!--* 生成一个Person实体对象写法：-->
<!--    ```objc-->
<!--    Person *person = [NSEntityDescription insertNewObjectForEntityForName:@"Person" inManagedObjectContext:context];-->
<!--    person.name = @"250";-->
<!--    person.age = [NSNumber numberWithInt:27];-->
<!--    Card *card = [NSEntityDescription insertNewObjectForEntityForName:@”Card" inManagedObjectContext:context];-->
<!--    card.no = @”4414245465656";-->
<!--    person.card = card;-->
<!--    ```-->
<footer class="page-footer"><span class="copyright">Copyright &#xA9; fzq2016 2016 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2016-06-06 14:54:24
</span></footer>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../save-sqlite3sqlite3/index.html" class="navigation navigation-prev " aria-label="Previous page: SQLite3存储"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../nsdata/index.html" class="navigation navigation-next " aria-label="Next page: NSData"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-splitter/splitter.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"tbfed-pagefooter":{"copyright":"Copyright &copy fzq2016 2016","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"splitter":{},"toggle-chapters":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
    </body>
    <!-- End of book 目录--回到所有书目录 -->
</html>
